#!/bin/bash

# Colors for terminal output - use printf or echo -e consistently
RED=$'\033[0;31m'
YELLOW=$'\033[1;33m'
GREEN=$'\033[0;32m'
NC=$'\033[0m' # No Color

# Get list of modified files
MODIFIED_FILES=$(git diff --cached --name-only)

# Check if any Vue pages were modified
PAGE_MODIFIED=false
PRICING_MODIFIED=false
LEGAL_MODIFIED=false

for file in $MODIFIED_FILES; do
    if [[ $file == app/pages/*.vue ]]; then
        PAGE_MODIFIED=true
        
        # Check specific critical pages
        if [[ $file == *pricing.vue ]]; then
            PRICING_MODIFIED=true
        fi
        if [[ $file == *privacy.vue ]] || [[ $file == *terms.vue ]]; then
            LEGAL_MODIFIED=true
        fi
    fi
done

# Display reminder if pages were modified
if [ "$PAGE_MODIFIED" = true ]; then
    echo ""
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo "${YELLOW}âš ï¸  SITEMAP LASTMOD REMINDER${NC}"
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    if [ "$PRICING_MODIFIED" = true ]; then
        echo "${RED}ğŸš¨ CRITICAL: You modified the PRICING page!${NC}"
        echo "${RED}   You MUST update lastmod in /server/api/__sitemap__/urls.ts${NC}"
        echo ""
    fi
    
    if [ "$LEGAL_MODIFIED" = true ]; then
        echo "${RED}âš–ï¸  LEGAL: You modified privacy or terms pages!${NC}"
        echo "${RED}   You MUST update lastmod in /server/api/__sitemap__/urls.ts${NC}"
        echo ""
    fi
    
    echo "${YELLOW}You modified page content. Did you update sitemap lastmod dates?${NC}"
    echo ""
    echo "ğŸ“ File to update: ${GREEN}/server/api/__sitemap__/urls.ts${NC}"
    echo ""
    echo "Ask yourself:"
    echo "  â€¢ Did you change content (text, images, features)? â†’ Update lastmod"
    echo "  â€¢ Is it just a typo fix or minor CSS? â†’ Skip update"
    echo ""
    echo "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    # Ask for confirmation with multiple options
    echo "Choose an option:"
    echo "  [y] Yes, I updated lastmod dates (or they don't need updating)"
    echo "  [s] Skip this check for now (commit anyway)"
    echo "  [n] No, cancel commit (I need to update lastmod)"
    echo ""
    read -p "Your choice (y/s/n): " -n 1 -r
    echo ""
    echo ""
    
    if [[ $REPLY =~ ^[Nn]$ ]]; then
        echo "${YELLOW}Commit cancelled. Please update /server/api/__sitemap__/urls.ts if needed, then commit again.${NC}"
        exit 1
    elif [[ $REPLY =~ ^[Ss]$ ]]; then
        echo "${YELLOW}âš ï¸  Skipping sitemap check. Remember to update lastmod if needed!${NC}"
        echo ""
    fi
    # If 'y' or 's', continue with commit
fi

# Continue with commit
exit 0