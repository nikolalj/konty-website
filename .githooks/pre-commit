#!/bin/bash

# Colors for terminal output
RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

# Get list of modified files
MODIFIED_FILES=$(git diff --cached --name-only)

# Check if any Vue pages were modified
PAGE_MODIFIED=false
PRICING_MODIFIED=false
LEGAL_MODIFIED=false

for file in $MODIFIED_FILES; do
    if [[ $file == app/pages/*.vue ]]; then
        PAGE_MODIFIED=true
        
        # Check specific critical pages
        if [[ $file == *pricing.vue ]]; then
            PRICING_MODIFIED=true
        fi
        if [[ $file == *privacy.vue ]] || [[ $file == *terms.vue ]]; then
            LEGAL_MODIFIED=true
        fi
    fi
done

# Display reminder if pages were modified
if [ "$PAGE_MODIFIED" = true ]; then
    echo ""
    echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${YELLOW}âš ï¸  SITEMAP LASTMOD REMINDER${NC}"
    echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    if [ "$PRICING_MODIFIED" = true ]; then
        echo -earnestly "${RED}ğŸš¨ CRITICAL: You modified the PRICING page!${NC}"
        echo -e "${RED}   You MUST update lastmod in /server/api/__sitemap__/urls.ts${NC}"
        echo ""
    fi
    
    if [ "$LEGAL_MODIFIED" = true ]; then
        echo -e "${RED}âš–ï¸  LEGAL: You modified privacy or terms pages!${NC}"
        echo -e "${RED}   You MUST update lastmod in /server/api/__sitemap__/urls.ts${NC}"
        echo ""
    fi
    
    echo -e "${YELLOW}You modified page content. Did you update sitemap lastmod dates?${NC}"
    echo ""
    echo -e "ğŸ“ File to update: ${GREEN}/server/api/__sitemap__/urls.ts${NC}"
    echo ""
    echo "Ask yourself:"
    echo "  â€¢ Did you change content (text, images, features)? â†’ Update lastmod"
    echo "  â€¢ Is it just a typo fix or minor CSS? â†’ Skip update"
    echo ""
    echo -e "${YELLOW}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    # Optional: Ask for confirmation
    read -p "Have you updated sitemap lastmod dates if needed? (y/n) " -n 1 -r
    echo ""
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo ""
        echo -e "${YELLOW}Commit paused. Please update /server/api/__sitemap__/urls.ts if needed, then commit again.${NC}"
        exit 1
    fi
fi

# Continue with commit
exit 0