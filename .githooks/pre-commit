#!/bin/bash

# Colors for terminal output
YELLOW=$'\033[1;33m'
GREEN=$'\033[0;32m'
NC=$'\033[0m' # No Color

# Get list of modified files
MODIFIED_FILES=$(git diff --cached --name-only)

# Check if any Vue files or translation files were modified
RELEVANT_MODIFIED=false
for file in $MODIFIED_FILES; do
    if [[ $file == *.vue ]] || [[ $file == app/locales/*.json ]]; then
        RELEVANT_MODIFIED=true
        break
    fi
done

# Display reminder if Vue or translation files were modified
if [ "$RELEVANT_MODIFIED" = true ]; then
    echo ""
    echo "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo "${YELLOW}📅 SITEMAP REMINDER${NC}"
    echo "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""
    echo "You modified Vue or i18n files. If you changed content (made visible changes) on any of these pages:"
    echo ""
    echo "${GREEN}/${NC} (homepage), ${GREEN}/pricing${NC}, ${GREEN}/products${NC}, ${GREEN}/products/retail${NC}, ${GREEN}/products/hospitality${NC}, ${GREEN}/privacy${NC}, ${GREEN}/terms${NC}"
    echo ""
    echo "👉 Update their lastmod date in: ${GREEN}/server/api/__sitemap__/urls.ts${NC}"
    echo ""
    echo "${YELLOW}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo ""

    # Use exec to ensure the read command works properly
    exec < /dev/tty
    read -p "Continue with commit? (y/n): " -n 1 -r REPLY
    echo ""

    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo ""
        echo "${YELLOW}Commit cancelled. Update sitemap if needed, then commit again.${NC}"
        exit 1
    fi
fi

# Continue with commit
exit 0
